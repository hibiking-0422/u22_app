

<%= form_tag calendar_path(current_user.id), method: :get,multipart: true do %>
<%= date_field_tag :day%>
<%= submit_tag "インポート" %>
<%end%>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- calendar.css読み込み -->

    <!-- jquery1.7.1 を読み込む -->
    <script src="jquery-1.10.2.min.js"></script>
    <script src="jquery-ui-1.10.3.custom.min.js"></script>
    　
    <!-- calendar.js読み込み -->
 

    <title>カレンダー</title>

</head>
    <style>
            #calendar:after {
    clear: both;
    display: block;
    content: "";
}
#calendar table {
    border-collapse: collapse;
    text-align: center;
    width: 100%;
    line-height: 1.5;
    float: left;
    margin: 10px 10px 10px 10px;
}
#calendar thead {
    border-right: 1px solid #000;
    border-left: 1px solid #000;
    border-bottom: 1px solid #000;
    
    background: #04162e;
}
#calendar thead th {
    padding: 10px;
    font-weight: bold;
    vertical-align: top;
    color: #fff;
}
#calendar tbody th {
    width: 150px;
    padding: 10px;
    font-weight: bold;
    vertical-align: top;
    border-bottom: 1px solid #ccc;
    background: #fff;
}
#calendar td {
    padding: 10px;
    vertical-align: top;
    border-bottom: 1px solid #ccc;
    border-right: 1px solid #ccc;
    text-align: center;
}

#day{
    border-left: 1px solid #ccc;
}

.space{
    color: black;

}

             
    </style>
<body  style="background-color: #f8f8f8;">

    <!-- メインコンテンツ -->
   <center>
    <div class="ui main text container">
        <h1 >カレンダー</h1>

        <div id="calendar">
            <!--ここにカレンダが入る-->
            
        </div>

        <div style="margin-top: 20px;">
            <button class="back" type="button">＜</button>
            <button class="next" type="button">＞</button>
        </div>
        <h3 id = rensyuu></h3>
    </div><!-- メインコンテンツ閉じ -->
    </center>
</body>
<script type="text/javascript">
    $(function(){
        var myDate = new Date();
        var myYear = myDate.getFullYear();  // 年を取得    
        var MyMonth = myDate.getMonth();    // 月を取得(0月～11月)
        setCalender(myYear,MyMonth);//カレンダー生成
        click_day(myYear, MyMonth);
        //問題数がメイン　時間は＋＠
        
         
        
 /*      $('#day .space').on('click',function(){
           $(this).css('color','#ebc000');
           
           //ここに日付を表示できたら完璧
           var click_day = myYear + '-' + (MyMonth+1) +'-' + $(this).text(); //日付の取得
           $('#rensyuu').html(click_day);
           
       });*/
    
    

        $('.next').click(function(){

            MyMonth++;
            if(MyMonth == 12){
                MyMonth = 0;
                myYear++;
            }
            
           $('#calendar').empty();
            
            $('#calendar').text(setCalender(myYear,MyMonth));
            click_day(myYear, MyMonth);
        });

        $('.back').click(function(){

            MyMonth--;
            if(MyMonth == -1){
                MyMonth = 11;
                myYear--;
            }
            $('#calendar').empty();
            $('#calendar').text(setCalender(myYear,MyMonth));
            click_day(myYear, MyMonth);
        });
    });
    
    var click_day = function (myYear, MyMonth){
    
     $('#day .space').on('click',function(){
           $(this).css('color','#ebc000');
           
           //ここに日付を表示できたら完璧
           var click_day = myYear + '-' + (MyMonth+1) +'-' + $(this).text(); //日付の取得
           $('#rensyuu').html(click_day);
           
       });
}


function setCalender(y,l){
    'use strict';
    var myDate = new Date();
    var myToday = myDate.getDate(); // 今日の'日'を退避
    var todayMyMonth = myDate.getMonth();   // 月を取得(0月～11月)
    var $calendar = $('#calendar');
    var myWeekTbl = new Array('月','火','水','木','金','土','日');   // 曜日テーブル定義
    var myMonthTbl= new Array(31,28,31,30,31,30,31,31,30,31,30,31); // 月テーブル定義
    var myYear = y;
    myDate = new Date(myYear,l);    // 今日の日付データ取得

    ((myYear % 4)===0 && (myYear % 100) !==0) || (myYear % 400)===0 ? myMonthTbl[1] = 29: 28;   // うるう年だったら...
    // ２月を２９日とする
    var myMonth = myDate.getMonth();    // 月を取得(0月～11月)
    myDate.setDate(1);  // 日付を'１日'に変えて、
    var myWeek = myDate.getDay() - 1;   // '１日'の曜日を取得
    if(myWeek == -1){
        myWeek = 6;
    }
    
    var myTblLine = Math.ceil((myWeek+myMonthTbl[myMonth])/7);  // カレンダーの行数
    var myTable = new Array(7*myTblLine);   // 表のセル数を用意
    for(var i=0; i<7*myTblLine; i++){
        myTable[i]=' '; // セルを全て空にする
    }
    
    for(i=0; i<myMonthTbl[myMonth]; i++){
       myTable[i+myWeek]=i+1;   // 日付を埋め込む myWeekでずらしてる
    }

    var source = '';
    var td = '<td>';
    var tdC = '</td>';
    var tr = '<tr>';
    var trC = '</tr>';

    for(i=0; i<myTblLine; i++){ // 表の「行」のループ カレンダーの日付のところ
        source += '<tr id = "day">';
        for (var j = 0; j < 7; j++) {
            var mydat = myTable[j+(i*7)];
            
                source += '<td class = "space">' + mydat + tdC;
               
            
        }
        source += trC;
    }
    var week = '';
    for(var k=0; k<7; k++){ // 曜日の欄を作る（weekTrに）

            week += '<td>' + myWeekTbl[k] + tdC;
        
    }
    var weekTr = '<tr id = "day">' + week + trC;
    //tableSourceにＨＴＭＬが記載されている
    var tableSource = '<table>' +
        '<tr><td colspan="7">' +
            myYear + '年' + (myMonth+1) + '月' +
            '</td></tr>' + weekTr + source + '</table>';

    $calendar.append(tableSource);  // 表の作成開始
    
    //色の変更を開始する
    //問題数は、int カンスト値 100問    時間は秒単位　＋＠なので適当     
    //問題数の配列を作る //
    var array_time = [0,10,20,30,40,50,60,70,80,90,100,110,2,130,0,0,10,20,0,40,50,0,70,80,0,30,0,50,60,0,20,100,0,100,0,100];
                //    1  2  3  4  5  6  7  8  9 10  11  12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
   
    var settei;
   for(i = 0; i < myMonthTbl[myMonth]; i++){//日付
        $('#day .space').html(function(index,element){
            if(index - myWeek == i)
            {
                //カラー設定
                if(array_time[i] <= 0 ){
                    $(this).css({'background-color': '#FFFFFF'});
                }else if(array_time[i] < 20){
                    $(this).css({'background-color': '#98fb98'});
                }else if(array_time[i] < 40){
                    $(this).css({'background-color': '#90ee90'});
                }else if(array_time[i] < 60){
                    $(this).css({'background-color': '#00ff7f'});
                }else if(array_time[i] < 80){
                    $(this).css({'background-color': '#3cb371'});
                }else if(array_time[i] < 100){
                    $(this).css({'background-color': '#228b22'});
                }else{
                    $(this).css({'background-color': '#006400'});
                }
                
                settei += index+' ';
            }
         
         
        })
                  
    }
    
    

    
}

</script>
</html>
